# Sample pod to be applied manually when desired
# Executes a backup against the DB when tailored to the right endpoint.
# Copies resulting full backup to $BUCKET
apiVersion: v1
kind: Pod
metadata:
  name: neo4j-backup
spec:
  restartPolicy: Never
  containers:
    - name: neo4j-backup
      image: gcr.io/neo4j-k8s-marketplace-public/neo4j-backup:latest
      env:
      - name: NEO4J_ADDR
        value: "neo4j-lsgm-neo4j-core-0.neo4j-lsgm-neo4j.default.svc.cluster.local"
      - name: BUCKET
        value: gs://tmp-k8s-backup-storage
      - name: BACKUP_NAME
        value: my-data
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /auth/credentials.json
      volumeMounts:
      - name: creds
        mountPath: /auth
        readOnly: true
  volumes:
  - name: creds
    secret:
      secretName: neo4j-backup-sa
      items:
      - key: credentials.json
        path: credentials.json
---
apiVersion: v1
kind: Secret
metadata:
  name: "neo4j-backup-sa"
  labels:
    app.kubernetes.io/name: "neo4j-backup-sa"
  annotations:
    marketplace.cloud.google.com/verification: test
data:
  credentials.json: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibmVvNGotazhzLW1hcmtldHBsYWNlLXB1YmxpYyIsCiAgInByaXZhdGVfa2V5X2lkIjogImUxZGZmZDU5NzVjOGIxNDBiMDM0MDY1ZGMzYzYyOGQ5YTQ5MGM1NTAiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRREJaN21ieVhFRVJkYzVcbkErOHB2MzBvUUR4Y0hoSzBuenB0R21RMU1iN09BS0VDNmRkTmxXSG1jR1hxQ2lyVUhjbVZJTElUanNlZHArSkxcbi9zczVvNmEvb3NyS010bzZEc3laMURSYmpvNWd5TzVuWXgyYTl4TlFqVUNOZlgvUzh6NGh6a3RaWmNTSlJjSnRcbnFmbDNINDBRdzdTOHNNbHVXSkFQQURrWGxqdG5nV0o1VHM4c3FpL2c2TzJWZUxFclFxRGRGR2Z0Uy90ckloM3RcbnlFeko3a2p5ZVJ1cGhiWE1zbXlZVTQvNUhrMjBOTmd6Z09zZmNLQS9QSjZIUUpXazlKeGRrWDAxdm51UG5QZTdcbjZDeXA4K1FXNVlVak5PazBWbmZZQ3RDbXBmMitMN2JWaXlXWWZZd3g1OTYyaG9jWUorUEhCSkNQV2p4UVNwdVZcbjVUWm9GS0hyQWdNQkFBRUNnZ0VBVW9PRzZFUyt6NFJlaU9nNVN0WDBOMDZFa2dhUWszZ1ZqTVBFT2YreHVLRURcbkVNT2toR2kxdm9ONHI2dkx6dml3YnN2bXZicGVSdENBRjAwcTlqbndZL1UzMEtGMmdtdWE5Z3hYbERKVFkwNkdcbmpCeDQzb3NJTmdjMW9jZ0gxMy9JbzlLb1NnbEZtdzFrb0xYeWhWUzBNaEZWRkdYV1lwb3RTQUVmMm9UUmJseENcbnBiUkl4cHdsNlVsOGk5aFluQUpHWFQ1T2pjS0xTWWZvcHQ5ZWtVUTgxYkE0TVhuVTI4eDIreVJUYk1Gb3B4aDJcbmlBQUpza0tzUU1BcWFDYThlNjRodnllTmh5UlEzVmpjTVliS21BTGhlTmNVSisraEtDRHdoWUFPa2p5RzlyN3lcbjR4NTNpV3g3ekFYbU1QMVFxQW0wMVhROTY3WUpwU3NaS0ZzR3J1eHBuUUtCZ1FEbU1td1FzYmNVdldrUklTblhcblk3V09tdlNCN3M5RGdnV3JPaFBnbEJNQnZ3d0xzRGZnTmk3bmk1L1dIeExNOURRcnNrOHNabXZHeE5JYnpjNDJcbnh1YllzWnlRVmduUUkranZZeUVOZURVeFNoM05BYWF3VTNIb25VQnQrTWJmcmVpWTFONG94T2RhVS9lY2tQYXRcbm5YU2FtS1FwZDMrTVAzejRwT2dSRktEQUx3S0JnUURYRll6ckE5SHFpQURaWmRqeW1QamRCL0ovTGNEQ1ZFUzhcbmdqZTJZNk1mOWIwT3RwQVQ3dGgvR081dGVBMWQ4YjJGQ05LZWlzSzJjYjhNalhGYmpjUUhhL3VNUGZZV2FlRVNcbjlaa1phT0JyVjNkOTZNMEdmZTFiV0N6Z3gycE9aaVExcCt6eXl2UGV2SzdWZHRIQVh2V29RTlJQdGJNOXplVXRcbmRhQjVySXZ2QlFLQmdBM3lzaStVeFJZaG4vTWt3a2RGeUdONnFpUVJWMGVzNGpFTTFOVi93Mk1RczJjbDUwelRcbm02WDJCTnBSaWE4WGdPM0E0U0U4bDMwMHdkSmpkd0pFclFvbVFPbFIvVWc2Vk12a2dzVXhLbS94SUxzaVJYcGJcbnBBUkhPdmN1NHNYODRLSWFDOWdHamtvZjJsb0hRcHNrZGtORHluYWt3ZnE2Z2hVQzBQanYrZ21MQW9HQkFOUXBcbnp1cll4czNKd01TeUlaSVU4WS9lMGdkQUU1L2R6andCVzRHUHdZNjZNZmI4Z1IwWWd2akVtQlRsMHBHejcxWDJcbmdRU2hMamNYOXZRajVna0F5N2ppZkswM1JiT1FWOVFDN2pYUmJXYVZUaXFtWlBBZGNmQ2tCd2puek9adS9STHNcbmhlQnQ4S2ZyaWE3SjJWZ2drOFNYeHBhbVRwd05xUjd4cEEzQjlmc2RBb0dCQU9Ray9sUXBRSVB2eEplSXFPaFhcbkI5cWZ0SW5kU1VZUWQ4QThmYlN0Wjk5QWVRLzBNZnNXL3B2UEUxZ2ovRUtsVzUyT2g2dU1kcXRqOU5KQXFTak1cbmdVR1ZwVW9BU01Ia2ZRbExUMjZTZDdUSit6ZUtjclhaa2J3N2FuQisvNWR4SXp4ZG9Vdi9qbVJVOFE0T0c0M2pcbk9Oby9wYVcrc21WTnJIeGFOUE1mVmZBWVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIms4cy1tYXJrZXRwbGFjZS1zYUBuZW80ai1rOHMtbWFya2V0cGxhY2UtcHVibGljLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwODI1NzYyMTI2MDM1MjY5NDQwNSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2s4cy1tYXJrZXRwbGFjZS1zYSU0MG5lbzRqLWs4cy1tYXJrZXRwbGFjZS1wdWJsaWMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0K